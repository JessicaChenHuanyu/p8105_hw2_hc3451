---
title: "p8105_hw2_hc3451"
author: "Huanyu Chen"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(readxl)
library(dplyr)
```

# Problem 1
```{r}
pols_month <- read.csv("/Users/huanyu/Documents/CUIMC/Data Science/p8105_hw2_hc3451/pols-month.csv")
snp <- read.csv("/Users/huanyu/Documents/CUIMC/Data Science/p8105_hw2_hc3451/snp.csv")
unemployment <- read.csv("/Users/huanyu/Documents/CUIMC/Data Science/p8105_hw2_hc3451/unemployment.csv")

# First Step of Data Cleaning: pols_month
pols_month <- pols_month |>
  separate(mon, into = c("year", "month", "day"), sep = "-") |>
  mutate(month = month.name[as.numeric(month)]) |>
  mutate(president = ifelse("prez_dem" == 1, "dem", "gop")) |>
  select(-prez_dem, -prez_gop, -day)
```

```{r}
# Second Step of Data Cleaning: snp
snp <- snp |>
  separate(date, into = c("month", "day", "year"), sep = "/") |>
  mutate(month = month.name[as.numeric(month)]) |>
  mutate(year = ifelse(as.numeric(year) <= 20, paste0("20", year), paste0("19", year))) |>
  select(year, month, everything())
```

```{r}
# Third Step of Data Cleaning: unemployment
unemployment = pivot_longer(unemployment, Jan:Dec, names_to = "month", values_to = "unemployment")
unemployment <- unemployment |>
  mutate(month = month.name[factor(month)]) |>
  mutate(year = tolower(Year)) |>
  select(-Year) |>
  select(year, month, unemployment)
```

```{r}
# Join the datasets
merged_data_1 <- merge(pols_month, snp, by = c("year", "month"), all.x = TRUE)
merged_data <- merge(merged_data_1, unemployment, by = c("year", "month"), all.x = TRUE)
```

# Conclusion
The final merged dataset involves three datasets: "pols" containing political data, "snp" with stock market information, and "unemployment" providing economic indicators. It comprises 822 observations and 12 variables, spanning from year 1947 to 2015. Key variables include `year`, `month`, and `unemployment_rate`, alongside some political and stock market indicators.

# Problem 2
```{r}
# mrTrash
mrTrash <- read_excel("/Users/huanyu/Documents/CUIMC/Data Science/p8105_hw2_hc3451/202207 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N549")

mrTrash <- janitor::clean_names(mrTrash)
mrTrash <- separate(mrTrash, date, into = c("year", "month", "day"), sep = "-")

mrTrash <- mrTrash |>
  select(dumpster, year, month, everything()) |>
  mutate(homes_powered = round(weight_tons * 500 / 30))
```

```{r}
# profTrash
profTrash <- read_excel("/Users/huanyu/Documents/CUIMC/Data Science/p8105_hw2_hc3451/202207 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", range = "A2:M96")

profTrash <- janitor::clean_names(profTrash)
profTrash <- separate(profTrash, date, into = c("year", "month", "day"), sep = "-")

profTrash <- profTrash |>
  select(dumpster, year, month, everything()) |>
  mutate(homes_powered = round(weight_tons * 500 / 30))
```

```{r}
# gwyTrash
gwyTrash <- read_excel("/Users/huanyu/Documents/CUIMC/Data Science/p8105_hw2_hc3451/202207 Trash Wheel Collection Data.xlsx", sheet = "Gwynnda Trash Wheel", range = "A2:K108")

gwyTrash <- janitor::clean_names(gwyTrash)
gwyTrash <- separate(gwyTrash, date, into = c("year", "month", "day"), sep = "-")

gwyTrash <- gwyTrash |>
  select(dumpster, year, month, everything()) |>
  mutate(homes_powered = round(weight_tons * 500 / 30))
```

```{r}
# Combine dataset
mrTrash <- mrTrash |>
  mutate(source = "Mr Trash") |>
  mutate(year = as.character(year))

profTrash <- profTrash |>
  mutate(source = "Prof Trash") |>
  mutate(year = as.character(year))

gwyTrash <- gwyTrash |>
  mutate(source = "Gwy Trash") |>
  mutate(year = as.character(year))

combined_trash <- bind_rows(mrTrash, profTrash, gwyTrash)
combined_trash <- combined_trash |>
  dplyr:::select(dumpster, year, month, day, source, everything()) |>
  arrange(year, match(month, month.name), day)

filtered_data <- combined_trash |>
  filter(source == "Gwy Trash" & year == 2021 & month == "07")

filtered_data

total_cigarette_butts_july_2021 <- sum(pull(filtered_data, cigarette_butts))
```

# Conclusion
This combined dataset has `r nrow(combined_trash)` observations. The variable `source` represents the origin of the data and `homes_powered` represents the number of homes powered based on electricity from trash. The total weight of trash collected by Professor Trash Wheel is `r sum(pull(profTrash, weight_tons))` and the total number of cigarette butts collected by Gwynnda in July of 2021 is `r total_cigarette_butts_july_2021`.

# Problem 3
```{r}
base <- read.csv("/Users/huanyu/Documents/CUIMC/Data Science/p8105_hw2_hc3451/MCI_baseline.csv", skip = 1)
base <- janitor::clean_names(base)
base <- base |>
  mutate(sex = if_else(sex == 0, 'female', 'male')) |>
  mutate(apoe4 = if_else(apoe4 == 0, 'non-carrier', 'carrier'))

base_filtered <- base |>
  filter(age_at_onset != ".")
```

Important steps in the import process and relevant features of the dataset include deleting the first row, cleaning variable names to a tidy format, and mutating the 'sex' and 'apoe4' variables from numeric values to their respective real categories. `r nrow(base)` participants were recruited, and of these `r nrow(base_filtered)` develop MCI.

```{r}
base_mean = mean(pull(base_filtered, current_age))

data_female <- base_filtered |>
  filter(sex == "female")
proportion <- sum(data_female$apoe4 == "carrier") / nrow(data_female)
```

The average baseline age is `r base_mean`. Moreover, `r sprintf("%.2f%%", 100*proportion)` of women in the study are APOE4 carriers.

```{r}
amyloid <- read.csv('/Users/huanyu/Documents/CUIMC/Data Science/p8105_hw2_hc3451/mci_amyloid.csv', skip = 1)
amyloid <- janitor::clean_names(amyloid)
amyloid <- amyloid |>
  rename(ratio_2_year = time_2,
         ratio_4_year = time_4,
         ratio_6_year = time_6,
         ratio_8_year = time_8)
```

Important steps in the import process and relevant features of the dataset include deleting the first row, cleaning variable names to a tidy format, and renaming variables to their respective real categories.
